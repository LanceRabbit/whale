<div class="container">

  <%= render :partial => "shared/tabs1", :locals => { :selected_item => '成立訂單' } %>
      
  <br>
  <label>商品條碼:</label>
  <input type="text" name="" id="bar-code" onkeypress="return searchProduct(event)">
  <h2>會員訊息</h2>
  <table class="table">
    <tbody class="customer-info">
      <tr>
        <th>姓名</th>
        <th>電話</th>
        <th>信箱</th>
        <th>地址</th>        
        <th>備註</th>
      </tr>
       <tr>
        <td><%= @member.name%></td>
        <td><%= @member.phone%></td>
        <td><%= @member.email%></td>
        <td class="address"><%= @member.address%></td>
        <td class="remark"><%= @member.remark%></td>         
      </tr>
    </tbody>
  </table>  
  <br>
  
  
  <h2>購買內容</h2>
  <table class="table">
    <tbody class="cart-item-list">
      <tr>
        <th>類型</th>
        <th>商品名稱</th>          
        <th>國際條碼</th>
        <th>定價</th>
        <th>購買數量</th>        
        <th>小計</th>
        <th>折扣金額</th>
        <th>售價</th>
        <th>打折方式</th>
        <th>#</th>
      </tr> 
             
      <% @cart_items.each do |item|%>

        <tr id="<%= item.product.id%>-<%=@index_hash[item.product.id]%>">
          <td><%=item.product.category%></td>
          <td><%=item.product.zh_name%></td>            
          <td><%=item.product.upc%></td> 
          <td class="price"><%= item.product.price %></td>
          <td>
            <span class="minus-item text-muted glyphicon glyphicon-minus"></span>
            <input type="text" name="" size="3" class="quantity text-center" value="<%=item.quantity%>">
            <span class="plus-item text-muted glyphicon glyphicon-plus"></span>
          </td>
          <td class="o-price">
            <%=item.origin_calculate%>
            <% if  item.discount_method_code == "B"%> 
            *
            <input type="text" name="" size="3" value="<%= item.discount_off %>" class="discount_off" onkeypress="return setItemDiscount(event)">
            %
            <% else %>
            <input type="hidden" name="" size="3" value="100" class="discount_off" onkeypress="return setDiscount(event)">
            <% end %>
          </td>           
          <td class="v-price"><%= item.origin_calculate - item.calculate %></td>
          <td class="d-price"><%= item.calculate %></td>  
          <td>
            <%= form_for [:cashier, item] do |f| %>
            <%= f.collection_select  :discount_method_code, DiscountMethod.all, :code, :content, {prompt: true}, {class: "discount-list form-control"} %>
            <% end%>
          </td>        
          <td>
            <span class="delete-item text-danger glyphicon glyphicon-trash"></span>
          </td>
          <% @index_hash[item.product.id] +=1%>
          <% @order.amount += item.calculate %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <hr>
  <input type="text" name="" placeholder="請輸入折扣金額" id="coupon-price">
  <button class="add-coupon" id="<%= @coupon.id%>">使用優惠卷</button>
  <br>
  <br>
  <div class="row">
    <div class="ship-info ">
      <%= form_for [:cashier, @order] do |f|%>
        <div class="col-md-7">
          <%= f.label :payment_method, "取貨方式" %>
          <%= f.radio_button :address ,"local", class:"local-radio" %>
          <%= f.label :address, "自取" %>
          <%= f.radio_button :address ," ",class:"ship-radio" %>
          <%= f.label :address, "宅配" %><br>
          <%= f.label :name, "姓名:" %>
          <%= f.text_field :name %><br>
          
          <%= f.label :phone, "電話:" %>
          <%= f.text_field :phone %><br>
          
          <%= f.label :address, "地址:" %>
          <%= f.text_field :address ,class:"input-address form-control" %><br>

          <%= f.label :payment_method, "付款方式:" %>
          <%= f.radio_button :payment_method ,"付現" %>
          <%= f.label :payment_method, "付現" %>
          <%= f.radio_button :payment_method ,"刷卡" %>
          <%= f.label :payment_method, "刷卡" %>
          <br>
          
          
          <%= f.label :remark ,"備註"%>
          <%= f.text_area :remark, class:"form-control" %>
        </div>
        <div class="col-md-2 col-md-offset-1 ">
          <label>原始總金額</label>
          <input class="form-control" type="text" value="<%= @order.amount%>" id="origin_amount" disabled="disabled">
    

          <%= f.label :discount_off, "X折扣%" %>
          <%= f.text_field :discount_off  ,class:"form-control", onkeypress:"return setOrderDiscount(event)"%>
         
          <%= f.label :amount, "折扣後總金額" %>
          <%= f.text_field :amount  ,class:"discount_amout form-control", onkeypress:"return setDiscountAmount(event)"%>
          <%= f.hidden_field :member_id, :value => @member.id %>
          <br>
          <br>
          <%= f.submit "結帳完成並成立訂單",class: "btn btn-success" %>
        </div>


        
      <% end %>
    </div>
    
      
      

  </div>
    
  <br>
  <h2>商品列表</h2>
  <table class="table" data-toggle="table">
    <thead>
      <tr>
        <th>類型</th>
        <th>商品名稱</th>
        <th data-sortable="true" data-field="price">定價</th>
        <th>國際條碼</th>       
        <th>#</th>
      </tr>
    </thead>
    <tbody class="product-list">    
    <% @products.each do |product| %>
      <% if product.status != "removed" %>
      <tr id="<%= product.id%>">
        <td><%=product.category%></td>
        <td><%=product.zh_name%></td>
        <td><%=product.price%></td>
        <td><%=product.upc%></td> 
    
        <td><button class="add_to_cart">購買</button></td>
      </tr>
      <% end %>
    <% end %>  
        
      
    </tbody>
  </table>  

</div>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.js"></script>

<!-- Latest compiled and minified Locales -->
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/locale/bootstrap-table-zh-CN.min.js"></script>

<script type="text/javascript">
  //讓進入頁面游標直接在barcode輸入匡
  var elem = $("#bar-code");
  elem.focus();
  elem.select;

  $(".ship-radio").on("click", function(event){
    
    $(".ship-info").find(".input-address").removeAttr('disabled');
  });

  $("#order_address_local").on("click", function(event){
    
    $(".ship-info").find(".input-address").attr('disabled','disabled');
  });

  $(".add-coupon").on("click", function(event){
    var id  = event.target.id;
    var coupon_price = $("#coupon-price").val(); 
    console.log(id);
    $.ajax({
      url: "/cashier/products/" + id + "/add_to_cart?coupon_price=" + coupon_price,
      method: "POST",
      dataType: "json",      
      success: function(data){        
        var cart_item = document.createElement("tr");
        var total_price = $("#origin_amount");
        var total_price_value = Number(total_price.val());
        var coupon_price = Number(data["coupon_price"]);
        var origin_amount = total_price_value+coupon_price;
        var discount_off = Number($("#order_discount_off").val());
        var discount_amout = Math.round(origin_amount*discount_off/100);
        var exist_cart_item = $(".cart-item-list").find("tr[id^="+data["id"]+"-]").length;
        console.log(coupon_price);
        $("#order_amount").val(discount_amout);

        $(total_price).val(origin_amount);



        cart_item.id = data["id"].toString() +"-" +exist_cart_item.toString();
        $(cart_item).find("select").val("D");
        $(cart_item).html($("#discount-template").html());
        $(cart_item).find(".category").html(data["category"]);
        $(cart_item).find(".zh_name").html(data["zh_name"]);
        $(cart_item).find(".price").html("0");
        $(cart_item).find(".upc").html(data["upc"]);
        $(".cart-item-list").append(cart_item);
        $(cart_item).find(".o-price").html("0");
        $(cart_item).find(".d-price").html(coupon_price);
        $(cart_item).find(".v-price").html(-coupon_price);

          
      }
    });
  }); 

  $(".product-list").on("click", ".add_to_cart", function(event){
    var id  = event.target.parentNode.parentNode.id;
    console.log(id);
    $.ajax({
      url: "/cashier/products/" + id + "/add_to_cart",
      method: "POST",
      dataType: "json",      
      success: function(data){        
        var cart_item = document.createElement("tr");
        var total_price = $("#origin_amount");
        var total_price_value = Number(total_price.val());
        var o_price = Number(data["price"]);
        var origin_amount = total_price_value+o_price;
        var discount_off = Number($("#order_discount_off").val());
        var discount_amout = Math.round(origin_amount*discount_off/100);
        var exist_cart_item = $(".cart-item-list").find("tr[id^="+data["id"]+"-]").length;

        $("#order_amount").val(discount_amout);

        $(total_price).val(origin_amount);

       
        console.log(data["id"]);
        console.log(exist_cart_item);

        cart_item.id = data["id"].toString() +"-" +exist_cart_item.toString();

        $(cart_item).html($("#order-item-template").html());
        $(cart_item).find(".category").html(data["category"]);
        $(cart_item).find(".zh_name").html(data["zh_name"]);
        $(cart_item).find(".price").html(o_price);
        $(cart_item).find(".upc").html(data["upc"]);
        $(".cart-item-list").append(cart_item);
        $(cart_item).find(".o-price").html(o_price);
        $(cart_item).find(".o-price").append('<input type="hidden" name="" size="3" value="100"  class="discount_off" onkeypress="return setItemDiscount(event)">');
        $(cart_item).find(".d-price").html(o_price);
        $(cart_item).find(".v-price").html("0");

          
      }
    });
  }); 


  $(".cart-item-list").on("click",".delete-item",function(event){
    var id = event.target.parentNode.parentNode.id;
    var index = id.indexOf("-");
    var product_id = id.substring(0,index);
    var item_index = id.substring(index+1,id.length);
    $.ajax({
      url: "/cashier/cart_items/" + product_id+"?item_index=" +item_index,
      method: "DELETE",
      dataType: "json",

      success: function(data){
        var total_price = $("#origin_amount");
        var total_price_value = Number(total_price.val());
        var price = Number(data["price"]);

        var origin_amount = total_price_value-price;
        var discount_off = Number($("#order_discount_off").val());
        var discount_amout = Math.round(origin_amount*discount_off/100);

        var exist_cart_item = $(".cart-item-list").find("tr[id^="+data["id"]+"-]").length;
        $("#order_amount").val(discount_amout);

        $(total_price).val((total_price_value-price));
        $(".cart-item-list").find("tr[id^="+data["id"]+"-"+data["item_index"]+"]").remove();

        for(i = 1+Number(data["item_index"]); i < exist_cart_item ; i++){
          $(".cart-item-list").find("tr[id^="+data["id"]+"-"+i+"]").attr("id",data["id"].toString() +"-" +(i-1));
          console.log(i);
        }
      }
    });
  });


  $(".cart-item-list").on("click",".plus-item",function(event){
    var id = event.target.parentNode.parentNode.id;
    var index = id.indexOf("-");
    var product_id = id.substring(0,index);
    var item_index = id.substring(index+1,id.length);
    $.ajax({
      url: "/cashier/cart_items/" + product_id +"/plus_quantity?item_index=" + item_index,
      method: "POST",
      dataType: "json",
      success: function(data){
        var total_price = $("#origin_amount");
        var total_price_value = Number(total_price.val());
        var l_price = Number(data["l_price"]);
        var v_price = Number(data["v_price"]);
        var d_price = Number(data["d_price"]);
        var origin_amount = total_price_value+d_price-l_price;
        var order_discount_off = Number($("#order_discount_off").val());
        var discount_amout = Math.round(origin_amount*order_discount_off/100);
        var id = data["id"]+ '-' + data["item_index"]
        var cart_item = $(".cart-item-list").find("#"+id);
        var item_discount_off = $(cart_item).find(".discount_off");


        console.log(data["item_index"]);
        console.log(id);
        console.log(data["id"]);
        $("#order_amount").val(discount_amout);
        $(total_price).val(origin_amount);

        
        $(cart_item).find(".quantity").val(data["quantity"]);
        $(cart_item).find(".o-price").html(data["o_price"]);
        if(item_discount_off.val() != "100")
        {
          $(cart_item).find(".o-price").append("*");
          $(cart_item).find(".o-price").append(item_discount_off);
          $(cart_item).find(".o-price").append("%");
        }
        else
        {
          $(cart_item).find(".o-price").append(item_discount_off);
        } 
        $(cart_item).find(".d-price").html(data["d_price"]);
        $(cart_item).find(".v-price").html(data["v_price"]);
      }
    })
  });

  $(".cart-item-list").on("click",".minus-item",function(event){
    var id = event.target.parentNode.parentNode.id;
    var index = id.indexOf("-");
    var product_id = id.substring(0,index);
    var item_index = id.substring(index+1,id.length);
    $.ajax({
      url: "/cashier/cart_items/" + product_id +"/minus_quantity?item_index=" +item_index,
      method: "POST",
      dataType: "json",
      success: function(data){
        if(data["success"] == "1"){
          var total_price = $("#origin_amount");
          var total_price_value = Number(total_price.val());
          var l_price = Number(data["l_price"]);
          var v_price = Number(data["v_price"]);
          var d_price = Number(data["d_price"]);
          var origin_amount = total_price_value+d_price-l_price;
          var order_discount_off = Number($("#order_discount_off").val());
          var discount_amout = Math.round(origin_amount*order_discount_off/100);
          var cart_item = $(".cart-item-list").find("#"+data["id"]+"-"+data["item_index"]);
          var item_discount_off = $(cart_item).find(".discount_off");

          $("#order_amount").val(discount_amout);
          $(total_price).val(origin_amount);

          
          $(cart_item).find(".quantity").val(data["quantity"]);
          $(cart_item).find(".o-price").html(data["o_price"]);
          if(item_discount_off.val() != "100")
          {
            $(cart_item).find(".o-price").append("*");
            $(cart_item).find(".o-price").append(item_discount_off);
            $(cart_item).find(".o-price").append("%");
          }
          else
          {
            $(cart_item).find(".o-price").append(item_discount_off);
          }     
          $(cart_item).find(".d-price").html(data["d_price"]);
          $(cart_item).find(".v-price").html(data["v_price"]);

        }        
      }
    })
  });



  //設定折扣方式
  $(".cart-item-list").on("change",".discount-list",function(event){ 
    var id = event.target.parentNode.parentNode.parentNode.id;
    var index = id.indexOf("-");
    var product_id = id.substring(0,index);
    var item_index = id.substring(index+1,id.length);
    var method_code = $(event.target).find(":selected").val();



    if(method_code == "B"){
      var str ;
      if(str=prompt("請輸入0-100的數字","100"))
      {
        console.log(str);

        $.ajax({
          url: "/cashier/cart_items/"+ product_id +"/add_discount?method_code="+method_code + "&discount=" + str +"&item_index=" +item_index,
          method: "post",
          dataType: "json",
          success: function(data){
            var total_price = $("#origin_amount");
            var total_price_value = Number(total_price.val());
            var l_price = Number(data["l_price"]);
            var v_price = Number(data["v_price"]);
            var d_price = Number(data["d_price"]);
            var cart_item = $(".cart-item-list").find("#"+data["id"]+"-"+data["item_index"]);            
            var item_discount_off = $(cart_item).find(".discount_off");
            console.log(cart_item.length);
            console.log(data["id"]);
            console.log(data["item_index"]);
            $(item_discount_off).val(data["discount_off"]);
            $(item_discount_off).prop("type","text");

            var origin_amount = total_price_value+(d_price-l_price);
            var order_discount_off = Number($("#order_discount_off").val());
            var discount_amout = Math.round(origin_amount*order_discount_off/100);

            $("#order_amount").val(discount_amout);

            $(cart_item).find(".discount_off").before("*");
            $(cart_item).find(".discount_off").after("%");
            $(cart_item).find(".v-price").html(data["v_price"]);
            $(cart_item).find(".d-price").html(data["d_price"]);
   
            $(total_price).val(origin_amount);
          } 
        });
      }
    }
    else if(method_code == "D"){
      if(str=prompt("請輸入修改金額",""))
      {
        console.log(str);

        $.ajax({
          url: "/cashier/cart_items/"+ product_id +"/add_discount?method_code=D" + "&discount=" + str+"&item_index=" +item_index,
          method: "post",
          dataType: "json",
          success: function(data){
            var total_price = $("#origin_amount");
            var total_price_value = Number(total_price.val());
            var l_price = Number(data["l_price"]);
            var v_price = Number(data["v_price"]);
            var d_price = Number(data["d_price"]);
            var cart_item = $(".cart-item-list").find("#"+data["id"]+"-"+data["item_index"]);          
            var item_discount_off = $(cart_item).find(".discount_off");
            var origin_amount = total_price_value+d_price-l_price;
            var order_discount_off = Number($("#order_discount_off").val());
            var discount_amout = Math.round(origin_amount*order_discount_off/100);

            console.log(cart_item.length);
            console.log(data["id"]);
            console.log(data["item_index"]);
            $(item_discount_off).val("100");
            $(item_discount_off).prop("type","hidden");

            $(cart_item).find(".o-price").html(data["o_price"]);
            $(cart_item).find(".o-price").append(item_discount_off);

            

            $("#order_amount").val(discount_amout);

            $(cart_item).find(".v-price").html(data["v_price"]);
            $(cart_item).find(".d-price").html(data["d_price"]);
   
            $(total_price).val(origin_amount);
          } 
        });
      }
    }
    else{
      $.ajax({
        url: "/cashier/cart_items/"+ product_id +"/add_discount?method_code="+method_code+"&item_index=" +item_index,
        method: "post",
        dataType: "json",
        success: function(data){
          var total_price = $("#origin_amount");
          var total_price_value = Number(total_price.val());
          var l_price = Number(data["l_price"]);
          var v_price = Number(data["v_price"]);
          var d_price = Number(data["d_price"]);
          var cart_item = $(".cart-item-list").find("#"+data["id"]+"-"+data["item_index"]);           
          var item_discount_off = $(cart_item).find(".discount_off");

          console.log(cart_item.length);
            console.log(data["id"]);
            console.log(data["item_index"]);

          $(item_discount_off).val("100");
          $(item_discount_off).prop("type","hidden");

          $(cart_item).find(".o-price").html(data["o_price"]);
          $(cart_item).find(".o-price").append(item_discount_off);

          var origin_amount = total_price_value+d_price-l_price;
          var order_discount_off = Number($("#order_discount_off").val());
          var discount_amout = Math.round(origin_amount*order_discount_off/100);

          $("#order_amount").val(discount_amout);

          

          $(cart_item).find(".v-price").html(data["v_price"]);
          $(cart_item).find(".d-price").html(data["d_price"]);
 
          $(total_price).val(origin_amount);
        } 
      });
    }    
  });



  //輸入barcode來搜尋商品
  function searchProduct(event) {
    
    if (event.keyCode == 13) {
        var barcode = $("#bar-code").val();
        console.log(barcode);
        $("#bar-code").val("");
        $.ajax({
          url: "/cashier/products/barcode_to_cart?barcode=" + barcode ,
            method: "POST",
            dataType: "json",      
            success: function(data){        
              if(data == null || data.length == 0){
                alert("No data found");
              }
              else{
                var cart_item = document.createElement("tr");
                var total_price = $("#origin_amount");
                var total_price_value = Number(total_price.val());
                var o_price = Number(data["price"]);
                var origin_amount = total_price_value+o_price;
                var discount_off = Number($("#order_discount_off").val());
                var discount_amout = Math.round(origin_amount*discount_off/100);
                var exist_cart_item = $(".cart-item-list").find("tr[id^="+data["id"]+"-]").length;

                $("#order_amount").val(discount_amout);

                $(total_price).val(origin_amount);

               
                console.log(data["id"]);
                console.log(exist_cart_item);

                cart_item.id = data["id"].toString() +"-" +exist_cart_item.toString();

                $(cart_item).html($("#order-item-template").html());
                $(cart_item).find(".category").html(data["category"]);
                $(cart_item).find(".zh_name").html(data["zh_name"]);
                $(cart_item).find(".price").html(o_price);
                $(cart_item).find(".upc").html(data["upc"]);
                $(".cart-item-list").append(cart_item);
                $(cart_item).find(".o-price").html(o_price);
                $(cart_item).find(".o-price").append('<input type="hidden" name="" size="3" value="100"  class="discount_off" onkeypress="return setItemDiscount(event)">');
                $(cart_item).find(".d-price").html(o_price);
                $(cart_item).find(".v-price").html("0");

              }    
                    
            }
        });
      return false;
    }
  }

  //變更單一品項打折框數字
  function setItemDiscount(event) {
    
    if (event.keyCode == 13) {
      var str = $(event.target).val();
      var id = event.target.parentNode.parentNode.id;
      console.log(id);

      console.log(str);


      $.ajax({
        url: "/cashier/cart_items/"+ id +"/add_discount?method_code=B" + "&discount=" + str,
        method: "post",
        dataType: "json",
        success: function(data){
          var total_price = $("#origin_amount");
          var total_price_value = Number(total_price.val());
          var l_price = Number(data["l_price"]);
          var v_price = Number(data["v_price"]);
          var d_price = Number(data["d_price"]);
          var cart_item = $(".cart-item-list").find("#"+data["id"]);
          var origin_amount = total_price_value+d_price-l_price;
          var order_discount_off = Number($("#order_discount_off").val());
          var discount_amout = Math.round(origin_amount*order_discount_off/100);

          $(cart_item).find(".d-price").html(data["d_price"]);
          $(cart_item).find(".v-price").html(data["v_price"]);
          $(total_price).val(origin_amount);
          $("#order_amount").val(discount_amout);
        } 
      });
    return false;
    }
  }

  //變更總金額打折框數字
  function setOrderDiscount(event) {
    
    if (event.keyCode == 13) {
      event.preventDefault();
      var origin_amount = Number($("#origin_amount").val());
      var discount_off = Number($(event.target).val());
      var discount_amout = Math.round(origin_amount*discount_off/100);//四捨五入
      console.log(discount_off);
      console.log(origin_amount);
      console.log(discount_amout);
      $("#order_amount").val(discount_amout);

      return false;
    }
  }

  //變更總金額
  function setDiscountAmount(event) {
    
    if (event.keyCode == 13) {
      event.preventDefault();
      var origin_amount = Number($("#origin_amount").val());
      var discount_amout = Number($(event.target).val());
      var discount_off = Math.round(discount_amout/origin_amount*100);
      
      console.log(discount_off);
      console.log(origin_amount);
      console.log(discount_amout);
      $("#order_discount_off").val(discount_off);

      return false;
    }
  }

  

</script>

<script type="text/template" id="order-item-template">
  <td class="category"></td>
  <td class="zh_name"></td>  
  <td class="upc"></td>
  <td class="price"></td> 
  <td>
    <span class="minus-item text-muted glyphicon glyphicon-minus"></span>
    <input type="text" name="" size="3" class="quantity text-center" value="1">
    <span class="plus-item text-muted glyphicon glyphicon-plus"></span>
  </td>
  <td class="o-price"></td> 
  <td class="v-price"></td>  
  <td class="d-price"></td>  
  <td class="discount_method">
    <form class="edit_cart_item" id="edit_cart_item_3" action="/cashier/cart_items/3" accept-charset="UTF-8" method="post">
      <input name="utf8" type="hidden" value="✓">
      <input type="hidden" name="_method" value="patch">
      <input type="hidden" name="authenticity_token" value="LckDhqbe2ZR6jq+KbjlrGQdj7+JAKBOGf+puxULIZde9GCuOwN3XI1zBLPfQHTDRm4RzYc6T9gXI93wZYOhhPA==">
      <select class="discount-list form-control" name="cart_item[discount_method_code]" id="cart_item_discount_method_code">
        <option value="A">第二件半價</option>
        <option value="B">打折</option>
        <option value="C">贈品</option>
        <option value="D">優惠價</option>
        <option selected="selected" value="E">無</option>
      </select>
    </form>
  </td>  
  <td>
    <span class="delete-item text-danger glyphicon glyphicon-trash"></span>
  </td>
</script>

<script type="text/template" id="discount-template">
  <td class="category"></td>
  <td class="zh_name"></td>  
  <td class="upc"></td>
  <td class="price"></td> 
  <td>
    <span class="minus-item text-muted glyphicon glyphicon-minus"></span>
    <input type="text" name="" size="3" class="quantity text-center" value="1">
    <span class="plus-item text-muted glyphicon glyphicon-plus"></span>
  </td>
  <td class="o-price"></td> 
  <td class="v-price"></td>  
  <td class="d-price"></td>  
  <td class="discount_method">
    <form class="edit_cart_item" id="edit_cart_item_3" action="/cashier/cart_items/3" accept-charset="UTF-8" method="post">
      <input name="utf8" type="hidden" value="✓">
      <input type="hidden" name="_method" value="patch">
      <input type="hidden" name="authenticity_token" value="LckDhqbe2ZR6jq+KbjlrGQdj7+JAKBOGf+puxULIZde9GCuOwN3XI1zBLPfQHTDRm4RzYc6T9gXI93wZYOhhPA==">
      <select class="discount-list form-control" name="cart_item[discount_method_code]" id="cart_item_discount_method_code">
        <option value="A">第二件半價</option>
        <option value="B">打折</option>
        <option value="C">贈品</option>
        <option selected="selected" value="D">優惠價</option>
        <option value="E">無</option>
      </select>
    </form>
  </td>  
  <td>
    <span class="delete-item text-danger glyphicon glyphicon-trash"></span>
  </td>
</script>
