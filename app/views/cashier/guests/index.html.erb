<div class="container">
  
  <ul class="nav nav-tabs">
    <li role="presentation" class="active"><%= link_to "客情資料",cashier_guests_path%></li>
    <li role="presentation" ><%= link_to "成立訂單",new_cashier_order_path(id: -1)%></li>
    <li role="presentation" ><%= link_to "搜尋會員",search_cashier_members_path%></li>
    <li role="presentation" ><%= link_to "新增會員",new_cashier_member_path%></li> 
    <li role="presentation" ><%= link_to "會員資料(測試用，暫時)", cashier_members_path %></li>
  </ul> 

    <br>
    <div style="text-align: center">
      <%= link_to '客情紀錄', cashier_guests_path %> |
      <%= link_to '今日客情', guest_today_cashier_guests_path %>
    </div>
    
<!--============== need your help ===================-->
    <form id="search-form">
      <input type="text" id="datepicker">
      <button id="date-search">日期搜尋</button>
    </form>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <script>
      $(function() {
        $( "#datepicker" ).datepicker();
      });

     $("#search-form").on("click","#date-search",function(event){
        event.preventDefault();
        $(".search-item").remove();//刪除原先的搜尋結果
          var date = $("#datepicker").val();
          console.log(date);
        $.ajax({
          url: "/cashier/guests/search_outcome" ,
          method: "POST",
          dataType: "json",
          data: {
            created_at: date,
          },
          success: function(datas){
            for(var i=0; i <datas.length;i++){
              var data = datas[i];
              var guest = document.createElement("tr");
              
              if(data["id"]==""){
                $(guest).html("No data fund");
              }
              else{
                guest.id = data["id"];
                $(guest).attr("class","search-item");
                <% id = %>
                $(guest).html($("#guest-template").html());
                $(guest).find(".id").html(data["id"]);
                $(guest).find(".created_at").html(data["time"]);
                $(guest).find(".payment").html(data["payment"]);
                $(guest).find(".gender").html(data["gender"]);
                $(guest).find(".guest_type").html(data["guest_type"]);
                $(guest).find(".country").html(data["country"]);
                $(guest).find(".age").html(data["age"]);
                $(guest).find(".info_way").html(data["info_way"]);
              

              }
              
              $("#search-list").append(guest);
              console.log(data["id"]);
            }
              
          }
        });  
      });

      </script>


      <script type="text/template" id="guest-template">
        
        <td class="id"></td>
        <td class="time"></td>
        <td class="payment"></td>
        <td class="gender"></td>
        <td class="guest_type"></td>
        <td class="country"></td>
        <td class="age"></td>
        <td class="info_way"></td>

        <td ><button class="edit"></button></td>
      </script>

      <table class="table">
        <tbody id="search-list">
          
          <tr>
                <th>編號</th>
                <th>時間截記</th>
                <th>購買金額</th>
                <th>性別</th>
                <th>客戶類型</th>
                <th>國籍</th>
                <th>年齡結構</th>
                <th>如何得知茶籽堂</th>
                <th>功能</th>
                <th>記錄人員</th>
          </tr>     
            
        </tbody>
      </table>  

<!--============== need your help ===================--> 


    <br>
    <%= link_to "新增客情" , new_cashier_guest_path , class: "btn btn-primary center-block" %>
    <br>
    <div class="col-md-12">

      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th class="alncenter">編號</th>
            <th class="alncenter">時間截記</th>
            <th class="alncenter">購買金額</th>
            <th class="alncenter">性別</th>
            <th class="alncenter">客戶類型</th>
            <th class="alncenter">國籍</th>
            <th class="alncenter">年齡結構</th>
            <th class="alncenter">如何得知茶籽堂</th>
            <th class="alncenter">功能</th>
            <th class="alncenter">記錄人員</th>
          </tr>
        </thead>
        <tbody>
          <% @guests.each do |guest| %>
          <tr>
            <th class="alncenter"><%= guest.id %></th>
            <td class="alncenter"><%= guest.created_at.localtime.to_s(:db)[0..15] %></td>
            <td class="alnright"><%= number_to_currency(guest.payment, precision: 0) %></td>
            <td class="alncenter"><%= guest.gender %></td>
            <td class="alncenter"><%= guest.guest_type.guest_type %></td>
            <td class="alncenter"><%= guest.country.country_type %></td>
            <td><%= guest.age.age_type %></td>
            <td><%= guest.info_way.news_channel %></td>
            <td>
              <% if guest.user == current_user  %>
                <%= link_to '編輯', edit_cashier_guest_path(guest) %> ｜
                <%= link_to '刪除', cashier_guest_path(guest), method: :delete, data: {confirm:"確定刪除?"} %>
              <% end %>
            </td>
            <td><%= guest.user.name %></td>
          </tr>
          <% end %>
        </tbody>
      </table>

  </div>
</div>
